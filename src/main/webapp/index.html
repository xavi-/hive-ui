<lift:surround with="default" at="content">
<head>
<style type="text/css">
/*<![CDATA[*/
    #board
    {
        border: 1px solid black;
        position: relative;
        width: 500px;
        height: 500px;
    }
    
    .piece
    {
        position: absolute;
        background-image: url(pics/hive-pieces.png);
        background-repeat: no-repeat;
        width: 91px;
        height: 80px;
    }
/*]]>*/
</style>
</head>
<div id="board">
</div>
<script type="text/javascript">
//<![CDATA[
(function(api) {
    var _width = 92 * 3 / 4, _height = 80;
    var _cartesianOffset = { 'a': { x: 0,       y: _height,      z: 0 },
                             'b': { x: _width,  y: _height / 2,  z: 0 },
                             'c': { x: _width,  y: -_height / 2, z: 0 },
                             'd': { x: 0,       y: -_height,     z: 0 },
                             'e': { x: -_width, y: -_height / 2, z: 0 },
                             'f': { x: -_width, y: _height / 2,  z: 0 },
                             'z': { x: 0,       y: 0,            z: 1 } };
    
    var getNeighbors = function(pos) {
        return { 'a': { x: pos.x,     y: pos.y + 1, z: pos.z },
                 'b': { x: pos.x + 1, y: pos.y,     z: pos.z },
                 'c': { x: pos.x + 1, y: pos.y - 1, z: pos.z },
                 'd': { x: pos.x,     y: pos.y - 1, z: pos.z },
                 'e': { x: pos.x - 1, y: pos.y,     z: pos.z },
                 'f': { x: pos.x - 1, y: pos.y + 1, z: pos.z },
                 'z': { x: pos.x,     y: pos.y,     z: pos.z + 1 } };
    };
    
    var serializePosition = function(pos) { return [pos.x, pos.y, pos.z].join(","); };
    var deserializePosition = function(pos) {
        var temp = pos.split(",");
        return { x: Number(temp[0]), y: Number(temp[1]), z: Number(temp[2]) };
    };
    
    var drawBoard = function(board) {
        var beenDrawn = {};
        
        var drawHex = (function() {
            spriteX = { 'bee': '0px ', 'beetle': '-90px ', 'grasshopper': '-181px ', 
                        'ant': '-272px ', 'spider': '-363px ', 'mosquito': '-454px ' };
            spriteY = { 'white': '-80px', 'black': '0px' };
            
            return function(point, tile) {
                $("<div>")
                    .addClass("piece")
                    .css({ left: point.x, top: point.y, 'z-index': point.z, 
                           'background-position': spriteX[tile[0]] + spriteY[tile[1]] })
                    .appendTo("#board");
            };
        })();
        
        var drawHelper = function(pos, point) {
            var serialPos = serializePosition(pos);
            
            if(beenDrawn[serialPos]) { return; }
            
            if(!board[serialPos]) { return; }
            
            drawHex(point, board[serialPos]);
            beenDrawn[serialPos] = true;
            
            var neighbors = getNeighbors(pos);
            for(var dir in neighbors) {
                var offset = _cartesianOffset[dir];
                drawHelper(neighbors[dir], { x: point.x + offset.x, y: point.y + offset.y });
            }
        };
        
        for(var pos in board) {
            drawHelper(deserializePosition(pos), { x: 180, y: 180 });
            break;
        }
    };
    
    drawBoard(api.board);
})({
  'board': 
  {
    '0,0,0': ['bee', 'white', '1'], 
    '1,0,0': ['beetle', 'white', '1'],
    '0,1,0': ['ant', 'black', '1'],
    '1,1,0': ['beetle', 'black', '1']
  },
  'hand':
  {
    'black': { 'ant': 3, 'spider': 2, 'beetle': 1, 'grasshopper': 3, 'bee': 1 },
    'white': { 'ant': 3, 'spider': 2, 'beetle': 2, 'grasshopper': 3 }
  },
  'turn-num': 3,
  'turn': 'white',
  'game-id': '39A2C',
  'timeout': 30,
  'text': 'your turn'
});
//]]>
</script>
</lift:surround>

